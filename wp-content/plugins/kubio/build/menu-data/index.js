(()=>{var e={9590:e=>{var t="undefined"!=typeof Element,n="function"==typeof Map,r="function"==typeof Set,o="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function i(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var a,u,c,l;if(Array.isArray(e)){if((a=e.length)!=s.length)return!1;for(u=a;0!=u--;)if(!i(e[u],s[u]))return!1;return!0}if(n&&e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(l=e.entries();!(u=l.next()).done;)if(!s.has(u.value[0]))return!1;for(l=e.entries();!(u=l.next()).done;)if(!i(u.value[1],s.get(u.value[0])))return!1;return!0}if(r&&e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(l=e.entries();!(u=l.next()).done;)if(!s.has(u.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(s)){if((a=e.length)!=s.length)return!1;for(u=a;0!=u--;)if(e[u]!==s[u])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((a=(c=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(u=a;0!=u--;)if(!Object.prototype.hasOwnProperty.call(s,c[u]))return!1;if(t&&e instanceof Element)return!1;for(u=a;0!=u--;)if(("_owner"!==c[u]&&"__v"!==c[u]&&"__o"!==c[u]||!e.$$typeof)&&!i(e[c[u]],s[c[u]]))return!1;return!0}return e!=e&&s!=s}e.exports=function(e,t){try{return i(e,t)}catch(e){if((e.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw e}}},4670:(e,t,n)=>{"use strict";e.exports=n(5607)},9829:(e,t,n)=>{"use strict";var r,o,i,s=n(8946),a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function u(){i=!1}function c(e){if(e){if(e!==r){if(e.length!==a.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,u()}}else r!==a&&(r=a,u())}function l(){return i||(i=function(){r||c(a);for(var e,t=r.split(""),n=[],o=s.nextValue();t.length>0;)o=s.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}e.exports={get:function(){return r||a},characters:function(e){return c(e),r},seed:function(e){s.seed(e),o!==e&&(u(),o=e)},lookup:function(e){return l()[e]},shuffled:l}},480:(e,t,n)=>{"use strict";var r,o,i=n(8416);n(9829),e.exports=function(e){var t="",n=Math.floor(.001*(Date.now()-1567752802062));return n===o?r++:(r=0,o=n),t+=i(7),t+=i(e),r>0&&(t+=i(r)),t+i(n)}},8416:(e,t,n)=>{"use strict";var r=n(9829),o=n(3766),i=n(296);e.exports=function(e){for(var t,n=0,s="";!t;)s+=i(o,r.get(),1),t=e<Math.pow(16,n+1),n++;return s}},5607:(e,t,n)=>{"use strict";var r=n(9829),o=n(480),i=n(1082),s=n(5636)||0;function a(){return o(s)}e.exports=a,e.exports.generate=a,e.exports.seed=function(t){return r.seed(t),e.exports},e.exports.worker=function(t){return s=t,e.exports},e.exports.characters=function(e){return void 0!==e&&r.characters(e),r.shuffled()},e.exports.isValid=i},1082:(e,t,n)=>{"use strict";var r=n(9829);e.exports=function(e){return!(!e||"string"!=typeof e||e.length<6||new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e))}},3766:e=>{"use strict";var t,n="object"==typeof window&&(window.crypto||window.msCrypto);t=n&&n.getRandomValues?function(e){return n.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},e.exports=t},8946:e=>{"use strict";var t=1;e.exports={nextValue:function(){return(t=(9301*t+49297)%233280)/233280},seed:function(e){t=e}}},5636:e=>{"use strict";e.exports=0},296:e=>{e.exports=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*r*n/t.length),i="";;)for(var s=e(o),a=o;a--;)if((i+=t[s[a]&r]||"").length===+n)return i}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{MENU_ITEM_BLOCK:()=>p,MenuEntityProvider:()=>_,createPrimaryMenu:()=>S,generateItemInitialData:()=>w,gutentagMenuEntity:()=>g,useMenuBlockEditor:()=>E,useMenusLocations:()=>j,usePrimaryMenuBlockEditor:()=>O});const e=window.wp.element,t=window.kubio.globalData,o=window.wp.apiFetch;var i=n.n(o);const s=window.wp.blocks,a=window.wp.data,u=window.wp.i18n,c=window.lodash;var l=n(9590),d=n.n(l),f=n(4670);const g={name:"menu",kind:"kubio",baseURL:"/kubio/v1/menu",plural:"menus",label:(0,u.__)("Menu","kubio"),mergedEdits:{meta:!0},getTitle:e=>{var t;return(0,c.isString)(null===(t=e)||void 0===t?void 0:t.data)&&(e=JSON.parse(e.data)),(0,c.get)(e,"menu.name",(0,u.__)("Menu Title","kubio"))}},p="kubio/menu-item",h={},v=(0,f.generate)();let m=(0,f.generate)();const b=()=>(h.context||(h.context=(0,e.createContext)()),h);function y(){var t;return null===(t=(0,e.useContext)(b().context))||void 0===t?void 0:t.id}const w=()=>{const e=-1*Date.now();return{id:e,parent:0,type:"custom",objectId:e,label:"",url:"",target:""}},M={content:{},isResolving:!1,hasResolved:!1,lastChange:v};function x(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=y(),o=null!=t?t:r,{editedEntity:i,isResolving:s,hasResolved:u}=(0,a.useSelect)((e=>o<0?{editedEntity:null,isResolving:!1,hasResolved:!0}:{editedEntity:e("core").getEditedEntityRecord(g.kind,g.name,o,n),isResolving:e("core").isResolving("getEditedEntityRecord",[g.kind,g.name,o,n]),hasResolved:e("core").hasFinishedResolution("getEditedEntityRecord",[g.kind,g.name,o,n])})),c=null==i?void 0:i.lastChange,l=null==i?void 0:i.data;return(0,e.useMemo)((()=>!parseInt(o)&&o<0?M:{content:l&&JSON.parse(l),isResolving:s,hasResolved:u,lastChange:c||v}),[o,l,s,u,c])}function R(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=y(),i=null!=n?n:o,{content:s,lastChange:u}=x(i,r),c=(0,e.useMemo)((()=>s&&s[t]),[s,t]),l=(0,e.useMemo)((()=>s&&(s.lastReloadUID||"")),[s]),{editEntityRecord:p}=(0,a.useDispatch)("core"),h=(0,e.useCallback)((function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r={...s,[t]:e,lastReloadUID:n?(0,f.generate)():s.lastReloadUID};if("items"===t){const t=[...s.items||[]].sort(((e,t)=>e.id-t.id)),n=[...e||[]].sort(((e,t)=>e.id-t.id));if(d()(t,n))return}p(g.kind,g.name,i,{data:JSON.stringify(r),lastChange:(0,f.generate)()})}),[i,t,s]);return[c,h,u,l]}const k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,c.isArray)(e)?e.filter((e=>e.parent===t&&!(0,c.isUndefined)(e.id))).sort(((e,t)=>e.order-t.order)).map((t=>{let{id:n,parent:r,label:o,url:i,target:a,object:u,type:c,objectId:l}=t;return(0,s.createBlock)(p,{id:n,parent:r,label:o,url:i,target:a,object:u,type:c,objectId:l},k(e,n))})):[]},E=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=y(),o=null!=t?t:r,{isResolving:i,hasResolved:s}=x(o,n),[a,u,l,f]=R("items",o,n),[g,p]=R("menu",o,n),h=(0,e.useCallback)((e=>{const t=(e=>{let t=0;const n=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,c.flatten)(e.map((e=>{let{attributes:o,innerBlocks:i}=e;const s=(0,c.merge)(w(),o);return t++,[{...(0,c.omit)(s,"kubio"),order:t,parent:r},...n(i,o.id)]})))};return n(e)})(e);d()(a,t)||u(t)}),[u,a]);return{id:o,items:a,setItems:u,onChange:h,menu:g,setMenu:p,onInput:c.noop,itemsToBlocks:k,isResolving:i,hasResolved:s,lastChangeUID:l,lastReloadUID:f}},L=()=>(0,a.select)("core/block-editor").getSettings().kubioPrimaryMenuLocation,O=()=>{const t=L(),{getMenuLocations:n}=j(),r=n(),o=(0,e.useMemo)((()=>{var e;return null===(e=(0,c.find)(r,{name:t}))||void 0===e?void 0:e.menu}),[(null==r?void 0:r.length)||0]);return{...E(o),exists:!!o}},S=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,u.__)("Main menu","kubio");const{saveMenu:t}=(0,a.dispatch)("core"),n=await t({name:e}),r=L();let o=null;n&&(o=n.id,await i()({path:"kubio/v1/menu/save-menu-location",method:"POST",data:{location:r,id:o}}),m=(0,f.generate)(),await(0,a.select)("core").getMenuLocations({_:m}))},j=()=>{const{menuLocations:e,setMenuLocations:n}=(0,t.useGlobalDataMenuLocations)(),{getMenuLocations:r,isResolvingLocation:o,hasResolvedLocations:i}=(0,a.useSelect)((e=>({getMenuLocations:e("core").getMenuLocations,isResolvingLocation:e("core").isResolving("getMenuLocations"),hasResolvedLocations:e("core").hasFinishedResolution("getMenuLocations")})));return{menuLocations:e||[],getMenuLocations:r,isResolvingLocation:o,hasResolvedLocations:i,updateLocationMenu:(t,r)=>{const o=e.map((e=>{const n={...e};return n.name===t&&(n.menu=parseInt(r)),n}));n(o)}}},_=t=>{let{id:n,children:r}=t;const o=b().context.Provider,i=(0,e.useMemo)((()=>({id:n})),[n]);return(0,e.createElement)(o,{value:i},r)};(()=>{const e=(0,a.subscribe)((()=>{const t=(0,a.select)("core"),n=(0,a.dispatch)("core");if(!t||!n)return;const r=t.getEntitiesConfig("kubio"),{addEntities:o}=n;(0,c.find)(r,{name:g.name})||(o([g]),e())}))})()})(),(window.kubio=window.kubio||{}).menuData=r})();
