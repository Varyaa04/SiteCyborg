(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{getSectionSlugFromPattern:()=>se,initFirebaseData:()=>C,initializeGutentagPatterns:()=>ne,normalizeCategorySlug:()=>re,registerBlockVariationFromPreset:()=>B,registerPattern:()=>J,registerPatternCategory:()=>Q,registerVariation:()=>U,sectionCategoryToLabel:()=>ae,useInitializeCloudPatterns:()=>oe});const n=window.kubio.constants,o=window.kubio.editorData,i=window.kubio.utils,r=window.wp.data,s=window.wp.element,a=window.wp.hooks,l=window.lodash;var c=e.n(l);const u=window.kubio.adminPanel,d=window.kubio.blockLibrary,f=window.kubio.core,g=window.kubio.pro,b=window.wp.i18n,p=(0,d.getNamesOfBlocks)(),k=(0,d.getBlocksByName)(),m=(()=>{const e={};return c().each(k,((t,n)=>{const o=c().get(t,"settings.inheritBlock");o&&(Array.isArray(e[o])||(e[o]=[]),e[o].push(n))})),e})(),h=e=>c().get(k,e+".settings.title",""),y=e=>h(e),S=e=>h(e)+"(from default preset)",v={};top.kubioDefaultPresetByBlockName=v;const w=(e,t)=>n=>{const{value:o}=n;U(t,(0,i.refreshBlockStyleRefs)({name:t,isDefault:!0,title:y(t),description:S(t),attributes:{},innerBlocks:[o]}));const[,r,s]=o;v[e]=o,U(e,(0,i.refreshBlockStyleRefs)({name:e,isDefault:!0,title:y(e),description:S(e),attributes:r,innerBlocks:s}))},P={[p.BUTTON]:w(p.BUTTON,p.BUTTON_GROUP),[p.LINK]:w(p.LINK,p.LINK_GROUP)},E=[p.SECTION,p.HERO,p.NAVIGATION],B=(e,t)=>{v[e]=t,U(e,(0,i.refreshBlockStyleRefs)({name:e,isDefault:!0,title:y(e),description:y(e),attributes:t[1],innerBlocks:t[2]}))},O=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];setTimeout(((e,t)=>{const{value:n}=e;if(c().has(P,t))return P[t](e);B(t,n),m[t]&&m[t].forEach((e=>{B(e,n)}))}),1,...t)};function _(e){const t=c().get(k,e,{}),{template:n}=t;n&&(T(n[0]),U(e,(0,i.refreshBlockStyleRefs)({name:e,isDefault:!0,title:y(e),description:y(e),attributes:{},innerBlocks:n})))}function T(e){const t=c().get(e,"2",[]);t.forEach(((e,n)=>{"function"==typeof e?c().set(t,n,e()):T(e)}))}const A=e=>(null==e?void 0:e.internalTags)||[],I=window.kubioUtilsData.showShopContent,N=["kubio-content/woocommerce","kubio-content/products"],C=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,u.initAdminStore)((async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const{sections:i,headers:r,footers:s,presets:u,cloudDefaults:d}=t;if((e=>{if(!e)return;(e=c().cloneDeep(e)).forEach((e=>{e.value=JSON.parse(e.value)}));const t={};e.forEach((e=>{t[e.component]=e})),c().each(t,O)})(d),setTimeout((()=>{E.forEach(_),M()}),200),e)return;const k=[].concat(i,r,s).filter((e=>{const t=e.categorySlug;return!(!I&&N.includes(t))})),m={},h=c().keyBy(n,"slug"),y=[],S=k.map((e=>{const t=e.categorySlug;m[t]=!0;const n=c().isString(e.value)?JSON.parse(e.value):e.value;let o;o=(e=>(0,g.isFreeVersion)()&&e.isPro)(e);const i={};null!=e&&e.context&&(i.context=e.context),null!=e&&e.filters&&(i.filters=e.filters);let r=c().get(e,"collections",[]);r=c().difference(r,["default"]);const s=(e=>(null==e?void 0:e.publicTags)||[])(e);s.forEach((e=>{y.includes(e)||y.push(e)}));let l={name:`${t}/${e.slug}/${e.id}`,title:e.name,categories:[t],slug:e.slug,collections:r,index:null==e?void 0:e.index,description:"Placeholder",screenshot:e.screenshot,fromFirebase:!0,isProPattern:null==e?void 0:e.isPro,isProOnFree:o,isGutentagPattern:!0,publicTags:s,internalTags:A(e),cloudPresetId:null==e?void 0:e.id,categoryCloudId:null==e?void 0:e.categoryId,fromColibri:!0,pairCloudPresetId:e.snippetPairId,content:n,...i};return l=(0,a.applyFilters)("kubio.firebasePatterns.beforeRegisterPattern",l),l}));let v=[];n.forEach((e=>{const t=e.slug,n=e.label;if(!m[t])return;let o={};const i=h[t];i&&(o={cloudId:null==i?void 0:i.id}),v.push({label:n,name:t,...o})})),v=(e=>{const t={label:(0,b.__)("Custom sections","kubio"),name:"kubio-content/custom"};return e.unshift(t),e})(v),((e,t)=>{const n=(0,f.composeBlockWithStyle)(p.SECTION,{},[]),o="kubio-content/blank",i={label:(0,b.__)("Blank","kubio"),name:o},r={name:`${o}/blank-section/9999`,slug:"blank-section",index:99999,title:(0,b.__)("Blank section","kubio"),categories:[o],description:(0,b.__)("Blank section","kubio"),screenshot:"https://content.colibriwp.com/screenshots/blank.png",fromColibri:!0,fromFirebase:!0,isProOnFree:!1,isGutentagPattern:!0,content:n,internalTags:[],publicTags:[]};e.push(r),t.push(i)})(S,v),Q(v),J(S);const w=u.map((e=>{const t=(0,l.isString)(e.value)?JSON.parse(e.value):e.value;let n={...e,name:`${e.component}/${e.id}`,content:t,title:e.name,cloudPresetId:e.id};return n=(0,a.applyFilters)("kubio.firebasePatterns.beforeRegisterPreset",n),n}));H(w);const P=o.filter((e=>!!e.is_public&&y.includes(e.slug)));W(P),M()}))};let R=null,F=null,D=null,L=null;const G="__experimentalBlockPatterns",K="__experimentalBlockPatternCategories",V="kubioBlockTags",q="kubioBlockPresets";let x=[],$=[],Y=[],z=[];const U=(e,t)=>{const n=(0,r.select)("core/blocks").getBlockType(e),o=(null==n?void 0:n.variationsFilter)||c().identity;if(n&&n.isPro)return;const s=(0,a.applyFilters)("kubio.register-variation",o(t),n),{addBlockVariations:l}=(0,r.dispatch)("core/blocks");l(e,(0,i.normalizeVariation)(s)),(0,a.doAction)("kubio.variation-added",e,s,((e,t)=>{l(e,(0,i.normalizeVariation)(t))}))},j=new Event("kubioVariationLoaded",{bubbles:!0}),M=()=>{(0,r.dispatch)(n.SESSION_STORE_KEY).setProp(n.GLOBAL_SESSION_ID,"variations-loaded",!0),document.body.dispatchEvent(j),setTimeout((()=>{(0,a.doAction)("kubio.blockPatterns.variationsRegistered")}),5e3)},J=e=>{Array.isArray(e)||(e=[e]),R?R(e):e.forEach((e=>{x.push(e)}))},H=e=>{Array.isArray(e)||(e=[e]),L?L(e):e.forEach((e=>{z.push(e)}))},Q=e=>{Array.isArray(e)||(e=[e]),F?F(e):e.forEach((e=>{$.push(e)}))},W=e=>{Array.isArray(e)||(e=[e]),D?D(e):e.forEach((e=>{Y.push(e)}))},X=function(e,t){var n,o;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!t)return t;if((0,l.isEmpty)(r)&&"imagesData"===i&&"kubio/image-gallery"===e)return t.map((e=>{let{caption:t,alt:n,url:o}=e;return{caption:t,alt:n,url:o,id:0}}));if((0,l.isEmpty)(r)&&"kubioAI"===i&&null!==(n=t)&&void 0!==n&&null!==(o=n.meta)&&void 0!==o&&o.initialValues&&delete t.meta.initialValues,(0,l.isEmpty)(r)&&"id"===i&&"kubio/image"===e)return 0;if((0,l.isString)(t))return"content"===i&&(t=t.replaceAll('<meta charset="utf-8"></meta>',"")),t;if((0,l.isArray)(t)){for(let n=0;n<t.length;n++)t[n]=X(e,t[n],n,[...r,i].filter(Boolean));return t}if((0,l.isObject)(t)){for(const n in t)t[n]=X(e,t[n],n,[...r,i].filter(Boolean));return t}return t},Z=e=>{const[t,n={},o=[]]=e,i=o.map(Z);return[t,X(t,n),i]},ee=()=>{const{updateSettings:e}=(0,r.dispatch)(n.STORE_KEY);R=(0,i.queueCall)((t=>{const o=(0,r.select)(n.STORE_KEY).getSettings(),i=o[G]||[],s=(0,l.flatten)((0,l.flatten)(t)).map((e=>({...e,content:Z(e.content)})));e({...o,[G]:c().uniqBy([...i,...s],"name")})}),500),F=(0,i.queueCall)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,r.select)(n.STORE_KEY).getSettings(),i=o[K]||[],s=(0,l.flatten)((0,l.flatten)(t)),a=c().uniqBy([...s,...i],"name");e({...o,[K]:a})}),500),L=(0,i.queueCall)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,r.select)(n.STORE_KEY).getSettings(),i=o[q]||[],s=(0,l.flatten)((0,l.flatten)(t));e({...o,[q]:c().uniqBy([...i,...s],"name")})}),500),D=(0,i.queueCall)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,r.select)(n.STORE_KEY).getSettings(),i=o[V]||[],s=(0,l.flatten)((0,l.flatten)(t));e({...o,[V]:c().uniqBy([...i,...s],"slug")})}),500),R(x),F($),D(Y),L(z),x=[],$=[],Y=[],z=[],window.kubioPatternsRegistered=!0},te=c().debounce(ee,2e3),ne=()=>{const e=(0,r.subscribe)((()=>{const{getProp:t}=(0,r.select)(n.SESSION_STORE_KEY);t(n.GLOBAL_SESSION_ID,"ready",!1)&&(e(),te())}))},oe=()=>{(0,s.useEffect)((()=>{C()}),[]);const[e]=(0,o.useGlobalSessionProp)("variations-loaded");(0,s.useEffect)((()=>{e&&ee()}),[e])};var ie;(0,a.addFilter)("kubio.firebasePatterns.beforeRegisterPattern","kubioMetadata",(e=>{const t=e.content,n=e.categories[0]||"",o=t[1]||[],i="kubioAI.meta";return c().get(o,i)||c().set(o,i,{}),c().set(o,`${i}.category`,n.split("/")[1]),c().set(o,`${i}.cloudPresetId`,e.cloudPresetId),c().unset(o,"kubio.props.aiData.category"),e})),null!==(ie=window.kubioBlockPatterns)&&void 0!==ie&&ie.inGutenbergEditor&&C(!0);const re=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=e.replace(/\s\s+/,"-").replaceAll(" ","-"),t&&(e=e.replace(/[^a-z0-9\-]/gi,"")),e},se=e=>{const t=((null==e?void 0:e.name)||"").split("/");return(0,l.get)(t,"2")},ae=e=>{switch(e.toLowerCase()){case"hero-accent":e="Hero Accent";break;case"cta":e="Call to Action";break;case"f.a.q.":e="F.A.Q."}return(0,l.upperFirst)(e.replace(/-/gim," "))};(window.kubio=window.kubio||{}).blockPatterns=t})();
