(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{openMediaPickerPopup:()=>p,useEffectAsync:()=>r,useUIVersion:()=>s});const o=window.wp.element,n=window.lodash,r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=(0,o.useRef)(e);r.current=e;const i=(0,o.useCallback)((function(){return r.current(...arguments)}),[]);(0,o.useEffect)((()=>{let e=!0;const t=i((()=>e));return()=>{(0,n.isFunction)(t)&&t(),e=!1}}),[i,...t])},i=window.kubio.constants,l=window.wp.data,s=()=>{const e=(0,l.useSelect)((e=>{var t,o;return(null===(t=e(i.STORE_KEY))||void 0===t||null===(o=t.getUIVersion)||void 0===o?void 0:o.call(t))||1}),[]),{setUIVersion:t=n.noop}=(0,l.useDispatch)(i.STORE_KEY)||{};return{uiVersion:e,setUIVersion:t}},u=window.wp.i18n,{wp:a}=window,c=e=>["sizes","mime","type","subtype","id","url","alt","link","caption"].reduce(((t,o)=>(null!=e&&e.hasOwnProperty(o)&&(t[o]=e[o]),t)),{});let d=null;const p=function(e){let{multiple:t=!1,allowedTypes:o=["image"],title:n=(0,u.__)("Select","kubio"),mode:r=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,l)=>{var s,u;d&&(null===(s=d)||void 0===s||null===(u=s.remove)||void 0===u||u.call(s)),d=a.media({title:n,multiple:t,library:{type:o}}),d.on("select",(()=>{const e=d.state().get("selection").toJSON();i(t?e:e[0])})),d.on("update",(e=>{const o=d.state(),n=e||o.get("selection");n&&n.models.length&&i(t?n.models.map((e=>c(e.toJSON()))):c(n.models[0].toJSON()))})),d.on("update",(()=>{const t=d.content.get();if(t&&t.collection){const e=t.collection;e.toArray().forEach((e=>e.trigger("destroy",e))),e.mirroring._hasMore=!0,e.more()}r&&t.mode(r);const o=Array.isArray(e)?!(null==e||!e.length):!!e,n=Array.isArray(e)?e:[e];if(!o)return;const i=d.state().get("selection");n.forEach((e=>{i.add(a.media.attachment(e))}));var l;(l=n,a.media.query({order:"ASC",orderby:"post__in",post__in:l,posts_per_page:-1,query:!0,type:"image"})).more().done((function(){}))})),d.on("update",(()=>{l(null)})),d.open()}))};(window.kubio=window.kubio||{}).coreHooks=t})();
